--- pipe.c.orig	2008-11-13 21:49:15.000000000 -0200
+++ pipe.c	2008-11-13 21:49:21.000000000 -0200
@@ -57,6 +57,11 @@
 extern char **environ;
 #endif
 
+#ifdef __APPLE__
+#include <crt_externs.h>
+#define environ (*_NSGetEnviron())
+#endif
+
 #ifndef STDIN_FILENO
 # define STDIN_FILENO 0
 #endif
